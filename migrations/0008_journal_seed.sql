-- Seed journal topics and references for grader module
INSERT INTO journal_topics (id, name, description) VALUES
    ('b624aa3e-93fe-5961-9e25-bf3c887a4300', 'Acoustics', NULL),
    ('d22ad37a-4cff-5f4f-9867-880e0066e723', 'Environmental Psychology', NULL),
    ('96b7999d-7614-578c-8ed5-8995b2f6fa8b', 'Urban Science', NULL),
    ('afba03a8-4973-5cdc-82be-07f99e804ca8', 'Sustainability', NULL),
    ('e342f543-f3b7-54f4-a84e-4655a00b7026', 'Building Architecture and Indoor Environmental Quality', NULL),
    ('38d8f349-fecd-56f0-a1bc-5f3dcb39b4de', 'Urban Park', NULL),
    ('a5aadc79-3369-5d25-8890-be93f5118a0a', 'Traffic Noise', NULL),
    ('752ad846-fcb8-565c-918c-a216d8531b3b', 'Computer Simulation', NULL),
    ('c5204009-5d08-531f-a616-316ee7dcbb3f', 'GIS or Mapping', NULL)
ON CONFLICT (name) DO UPDATE
    SET description = COALESCE(EXCLUDED.description, journal_topics.description);

WITH journal_data (id, journal_name, reference_mark, low_bound) AS (
    VALUES
    ('d8798afd-4b4a-51f8-a960-bf7081b987f5', 'Acta Acustica', '3/4', 35.9),
    ('8eb2a492-5253-5407-aad9-9572525ee63d', 'Applied Acoustics', '1/2', 36.95),
    ('e925ca65-27bd-5316-9f21-a802e9e63467', 'Applied Sciences', '2/4', 32.1),
    ('8a8c2f21-004d-50bc-8f37-c2989b597bcd', 'Behavioral Sciences', '2/3', 33.65),
    ('a0a4b569-7819-5589-9b27-55c302f144b0', 'Building and Environment', '1', 40.45),
    ('9500f43d-bc7e-5ed5-96ed-27f5112187bc', 'Building Research & Information', '1/3', 35.4),
    ('b67cfe56-0874-5c84-b328-f668f0882f79', 'Building Simulation', '1', 38.65),
    ('5793ffa9-5dae-5e04-9bb7-13e797c1d3d1', 'Buildings', '2/3', 33.8),
    ('6d1a5aed-868c-5f90-92af-072d4e12db75', 'Cities', '1', 43.35),
    ('f733c4cb-f35c-5c20-bea2-024e3d816f47', 'Communications Earth & Environment', NULL, 56.45),
    ('23346344-c37d-57f3-839a-dcaebbcfc6eb', 'Computers, Environment and Urban Systems', '1', 37.35),
    ('33562461-73af-56a2-a55a-27d538cb0f37', 'Ecological Indicators', '1', 36.95),
    ('cfa18a3e-f376-51ab-bd79-551a4170b947', 'Environment and Behavior', '1/2', 41.05),
    ('680f244d-4e66-52b7-8b2e-74159849d8a6', 'Environment and Planning B: Urban Analytics and City Science', '1/2', 39.3),
    ('1b359cfc-c58e-5a28-bcd0-4fe8fd441de8', 'Environment International', '1', 51.8),
    ('acc0394d-5a20-5da1-8b11-b98590596096', 'Environmental Impact Assessment Review', '1', 38.15),
    ('e01fc6e7-cf88-5966-b7b9-fd8fd45dfe73', 'Environmental Research', '1/2', 38.8),
    ('2559cd1b-ddbc-5bac-a9d2-f172150a9802', 'Forests', '2/3', 35.25),
    ('a6cadc7d-ace4-5be3-aada-293e62d6c2f7', 'Frontiers in Psychology', '1/3', 34.4),
    ('82bcb203-2600-5231-b111-7e6e71112d90', 'Frontiers of Architectural Research', '1', 36.85),
    ('aafb9225-9c58-595f-82e3-8dc291bfe85c', 'Health & Place', '1/2', 41.4),
    ('ad9b55cc-3f74-55dd-9032-1db763906e7f', 'Humanities & Social Sciences Communications', '1/2', 35.3),
    ('88f986d9-b714-52b3-a90a-d45bc7b4d891', 'Indoor and Built Environment', '2/3', 32.9),
    ('022cb7f0-826c-505f-a042-e4b581e8cdc0', 'ISPRS International Journal of Geo-Information', '2/3', 33.3),
    ('fa0c3c2c-2a19-5b03-bf0e-ab7675c8ab05', 'Journal of Asian Architecture and Building Engineering', '3/4', 30.35),
    ('2acc5d74-989d-5d6d-aa82-8498ad9b0333', 'Journal of Building Engineering', '1/2', 36.55),
    ('c6ad59f6-841d-5475-94d3-1429a18de60f', 'Journal of Cleaner Production', '1', 37.1),
    ('38ff0f67-b7c0-503b-a169-8d66f63198bd', 'Journal of Environmental Management', '1/2', 37.75),
    ('87a00711-5a46-5998-bd2d-fd798770fb85', 'Journal of Environmental Psychology', '1', 38.15),
    ('adf7befb-157b-5ab9-b0bc-9271da4ff295', 'Journal of Forestry Research', '1', 35.9),
    ('6182c98f-bc29-523d-abb5-df23aa9f9165', 'Journal of Leisure Research', '2/3', 33.3),
    ('a897f83f-5201-5a41-a9f3-72d831cfec6f', 'Journal of Outdoor Recreation and Tourism', '1/3', 34.3),
    ('e40984a2-a338-5cfc-8d89-19043b549302', 'Journal of the Acoustical Society of America', '1/3', 36.8),
    ('821ebc05-d148-5ed4-b5b2-bc4776191559', 'Landscape and Urban Planning', '1', 48.75),
    ('2cf20877-5c95-5a7d-bb24-d9874459cd84', 'Nature Cities', NULL, 69.3),
    ('4b9e6f63-8490-5527-883a-4385ba2c05b3', 'Nature Communications', '1', 68.9),
    ('ea7fb92d-30e3-5b35-9a0f-9f4233142bad', 'npj Urban Sustainability', '1', 43.5),
    ('0962303d-3512-5420-a069-0fb0a511fcdc', 'People and Nature', '1/2', 37.85),
    ('d80b4b9d-a4fc-515f-8465-eb796571b812', 'Plos One', '2/3', 34.4),
    ('ee99fd27-8a0c-5025-b37b-322fead5cf86', 'Proceedings of the National Academy of Sciences', '1', 73.35),
    ('c0688beb-afd4-59de-83e3-733e1d3d216d', 'Science Advances', '1', 82.4),
    ('6adc97b5-17b1-56fa-8c90-e1433218b244', 'Science of the Total Environment', '1/2', 38.85),
    ('02e06823-29fa-5629-b087-4f1f3b71a85f', 'Scientific Reports', '1/3', 34.9),
    ('1697794e-4555-5c12-a039-14a0e71f64e3', 'Sustainability', '2/3', 30.3),
    ('e3acc5bc-77e1-5081-9641-5ac4a802f9ae', 'Sustainable Cities and Society', '1', 41.25),
    ('99b31ade-09f7-5140-87f0-669e6b9232bb', 'Transportation Research Part D: Transport and Environment', '1', 39.55),
    ('fd818438-5ba8-5ef6-a073-aff11cb2258f', 'Urban Forestry & Urban Greening', '1/2', 37.7),
    ('b3eb3040-33d9-50a2-a26d-49da286a7574', 'Urban Studies', '1', 37.6)
),
upserted AS (
    INSERT INTO journal_reference_entries (id, journal_name, reference_mark, low_bound, notes)
    SELECT id, journal_name, reference_mark, low_bound, NULL
    FROM journal_data
    ON CONFLICT (journal_name) DO UPDATE
        SET reference_mark = EXCLUDED.reference_mark,
            low_bound = EXCLUDED.low_bound,
            notes = COALESCE(EXCLUDED.notes, journal_reference_entries.notes),
            updated_at = NOW()
    RETURNING journal_name, id
),
all_journals AS (
    SELECT journal_name, id FROM upserted
    UNION
    SELECT j.journal_name, j.id
    FROM journal_reference_entries j
    JOIN journal_data d ON d.journal_name = j.journal_name
),
score_input (journal_name, topic_name, score) AS (
    VALUES
    ('Acta Acustica', 'Acoustics', 2),
    ('Acta Acustica', 'Traffic Noise', 1),
    ('Applied Acoustics', 'Acoustics', 2),
    ('Applied Acoustics', 'Traffic Noise', 1),
    ('Applied Acoustics', 'Urban Park', 1),
    ('Applied Sciences', 'Acoustics', 2),
    ('Applied Sciences', 'Building Architecture and Indoor Environmental Quality', 1),
    ('Applied Sciences', 'Sustainability', 1),
    ('Applied Sciences', 'Traffic Noise', 1),
    ('Applied Sciences', 'Urban Science', 1),
    ('Behavioral Sciences', 'Environmental Psychology', 2),
    ('Behavioral Sciences', 'Sustainability', 1),
    ('Building and Environment', 'Building Architecture and Indoor Environmental Quality', 1),
    ('Building and Environment', 'Sustainability', 1),
    ('Building and Environment', 'Urban Park', 1),
    ('Building Research & Information', 'Building Architecture and Indoor Environmental Quality', 2),
    ('Building Simulation', 'Building Architecture and Indoor Environmental Quality', 2),
    ('Building Simulation', 'Computer Simulation', 2),
    ('Buildings', 'Building Architecture and Indoor Environmental Quality', 2),
    ('Buildings', 'Environmental Psychology', 1),
    ('Cities', 'Urban Science', 2),
    ('Communications Earth & Environment', 'Sustainability', 1),
    ('Communications Earth & Environment', 'Urban Science', 1),
    ('Computers, Environment and Urban Systems', 'Computer Simulation', 2),
    ('Computers, Environment and Urban Systems', 'Environmental Psychology', 1),
    ('Computers, Environment and Urban Systems', 'GIS or Mapping', 1),
    ('Computers, Environment and Urban Systems', 'Traffic Noise', 1),
    ('Ecological Indicators', 'Traffic Noise', 1),
    ('Ecological Indicators', 'Urban Park', 1),
    ('Ecological Indicators', 'Urban Science', 1),
    ('Environment and Behavior', 'Environmental Psychology', 2),
    ('Environment and Behavior', 'Urban Park', 1),
    ('Environment and Behavior', 'Urban Science', 1),
    ('Environment and Planning B: Urban Analytics and City Science', 'Sustainability', 1),
    ('Environment and Planning B: Urban Analytics and City Science', 'Urban Science', 2),
    ('Environment International', 'Computer Simulation', 1),
    ('Environment International', 'Sustainability', 2),
    ('Environment International', 'Traffic Noise', 1),
    ('Environment International', 'Urban Science', 1),
    ('Environmental Impact Assessment Review', 'Sustainability', 1),
    ('Environmental Impact Assessment Review', 'Traffic Noise', 1),
    ('Environmental Impact Assessment Review', 'Urban Science', 1),
    ('Environmental Research', 'Sustainability', 1),
    ('Environmental Research', 'Urban Park', 1),
    ('Environmental Research', 'Urban Science', 1),
    ('Forests', 'Environmental Psychology', 1),
    ('Forests', 'Sustainability', 1),
    ('Forests', 'Urban Park', 2),
    ('Frontiers in Psychology', 'Environmental Psychology', 2),
    ('Frontiers in Psychology', 'Urban Park', 1),
    ('Frontiers of Architectural Research', 'Building Architecture and Indoor Environmental Quality', 2),
    ('Frontiers of Architectural Research', 'Environmental Psychology', 1),
    ('Health & Place', 'Building Architecture and Indoor Environmental Quality', 1),
    ('Health & Place', 'Environmental Psychology', 1),
    ('Health & Place', 'Urban Park', 1),
    ('Humanities & Social Sciences Communications', 'Environmental Psychology', 1),
    ('Humanities & Social Sciences Communications', 'Sustainability', 1),
    ('Humanities & Social Sciences Communications', 'Urban Park', 1),
    ('Humanities & Social Sciences Communications', 'Urban Science', 1),
    ('Indoor and Built Environment', 'Building Architecture and Indoor Environmental Quality', 2),
    ('ISPRS International Journal of Geo-Information', 'Computer Simulation', 1),
    ('ISPRS International Journal of Geo-Information', 'GIS or Mapping', 2),
    ('Journal of Asian Architecture and Building Engineering', 'Building Architecture and Indoor Environmental Quality', 2),
    ('Journal of Asian Architecture and Building Engineering', 'Urban Science', 1),
    ('Journal of Building Engineering', 'Building Architecture and Indoor Environmental Quality', 2),
    ('Journal of Cleaner Production', 'Sustainability', 2),
    ('Journal of Environmental Management', 'Environmental Psychology', 1),
    ('Journal of Environmental Management', 'Traffic Noise', 1),
    ('Journal of Environmental Management', 'Urban Park', 1),
    ('Journal of Environmental Management', 'Urban Science', 1),
    ('Journal of Environmental Psychology', 'Environmental Psychology', 2),
    ('Journal of Environmental Psychology', 'Urban Park', 1),
    ('Journal of Environmental Psychology', 'Urban Science', 1),
    ('Journal of Forestry Research', 'Urban Park', 2),
    ('Journal of Leisure Research', 'Environmental Psychology', 1),
    ('Journal of Leisure Research', 'Urban Park', 2),
    ('Journal of Outdoor Recreation and Tourism', 'Environmental Psychology', 1),
    ('Journal of Outdoor Recreation and Tourism', 'Urban Park', 2),
    ('Journal of the Acoustical Society of America', 'Acoustics', 2),
    ('Journal of the Acoustical Society of America', 'Traffic Noise', 1),
    ('Journal of the Acoustical Society of America', 'Urban Park', 1),
    ('Landscape and Urban Planning', 'Environmental Psychology', 1),
    ('Landscape and Urban Planning', 'Urban Park', 1),
    ('Landscape and Urban Planning', 'Urban Science', 1),
    ('Nature Cities', 'Building Architecture and Indoor Environmental Quality', 1),
    ('Nature Cities', 'Environmental Psychology', 1),
    ('Nature Cities', 'Sustainability', 1),
    ('Nature Cities', 'Traffic Noise', 1),
    ('Nature Cities', 'Urban Park', 1),
    ('Nature Cities', 'Urban Science', 2),
    ('Nature Communications', 'Acoustics', 1),
    ('Nature Communications', 'Environmental Psychology', 1),
    ('Nature Communications', 'GIS or Mapping', 1),
    ('Nature Communications', 'Sustainability', 1),
    ('Nature Communications', 'Traffic Noise', 1),
    ('Nature Communications', 'Urban Park', 1),
    ('Nature Communications', 'Urban Science', 1),
    ('npj Urban Sustainability', 'Building Architecture and Indoor Environmental Quality', 1),
    ('npj Urban Sustainability', 'Environmental Psychology', 1),
    ('npj Urban Sustainability', 'Sustainability', 1),
    ('npj Urban Sustainability', 'Urban Park', 1),
    ('npj Urban Sustainability', 'Urban Science', 2),
    ('People and Nature', 'Environmental Psychology', 1),
    ('People and Nature', 'Urban Park', 2),
    ('Plos One', 'Acoustics', 1),
    ('Plos One', 'Building Architecture and Indoor Environmental Quality', 1),
    ('Plos One', 'Computer Simulation', 1),
    ('Plos One', 'Environmental Psychology', 1),
    ('Plos One', 'GIS or Mapping', 1),
    ('Plos One', 'Sustainability', 1),
    ('Plos One', 'Traffic Noise', 1),
    ('Plos One', 'Urban Park', 1),
    ('Plos One', 'Urban Science', 1),
    ('Proceedings of the National Academy of Sciences', 'Environmental Psychology', 1),
    ('Proceedings of the National Academy of Sciences', 'Sustainability', 1),
    ('Proceedings of the National Academy of Sciences', 'Traffic Noise', 1),
    ('Proceedings of the National Academy of Sciences', 'Urban Park', 1),
    ('Proceedings of the National Academy of Sciences', 'Urban Science', 1),
    ('Science Advances', 'Acoustics', 1),
    ('Science Advances', 'Environmental Psychology', 1),
    ('Science Advances', 'GIS or Mapping', 1),
    ('Science Advances', 'Sustainability', 1),
    ('Science Advances', 'Traffic Noise', 1),
    ('Science Advances', 'Urban Park', 1),
    ('Science Advances', 'Urban Science', 1),
    ('Science of the Total Environment', 'Environmental Psychology', 1),
    ('Science of the Total Environment', 'Sustainability', 1),
    ('Science of the Total Environment', 'Urban Park', 1),
    ('Science of the Total Environment', 'Urban Science', 1),
    ('Scientific Reports', 'Acoustics', 1),
    ('Scientific Reports', 'Building Architecture and Indoor Environmental Quality', 1),
    ('Scientific Reports', 'Computer Simulation', 1),
    ('Scientific Reports', 'Environmental Psychology', 1),
    ('Scientific Reports', 'GIS or Mapping', 1),
    ('Scientific Reports', 'Sustainability', 1),
    ('Scientific Reports', 'Traffic Noise', 1),
    ('Scientific Reports', 'Urban Park', 1),
    ('Scientific Reports', 'Urban Science', 1),
    ('Sustainability', 'Sustainability', 2),
    ('Sustainability', 'Urban Park', 1),
    ('Sustainability', 'Urban Science', 1),
    ('Sustainable Cities and Society', 'Sustainability', 1),
    ('Sustainable Cities and Society', 'Urban Science', 1),
    ('Transportation Research Part D: Transport and Environment', 'Traffic Noise', 2),
    ('Urban Forestry & Urban Greening', 'Urban Park', 2),
    ('Urban Studies', 'Sustainability', 1),
    ('Urban Studies', 'Urban Science', 2)
),
score_rows AS (
    SELECT
        aj.id AS journal_id,
        t.id AS topic_id,
        score::smallint AS score
    FROM score_input si
    JOIN all_journals aj ON aj.journal_name = si.journal_name
    JOIN journal_topics t ON LOWER(t.name) = LOWER(si.topic_name)
    WHERE si.score > 0
),
removed AS (
    DELETE FROM journal_topic_scores
    WHERE journal_id IN (SELECT id FROM all_journals)
    RETURNING 1
)
INSERT INTO journal_topic_scores (journal_id, topic_id, score)
SELECT journal_id, topic_id, score
FROM score_rows;
